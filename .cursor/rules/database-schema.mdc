# ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ê·œì¹™

## ğŸ“Š ERD í…Œì´ë¸” êµ¬ì¡°

### ì‚¬ìš©ì ê³„ì • í…Œì´ë¸”

#### 1. admin_user (ê´€ë¦¬ì ê³„ì •)

```typescript
interface AdminUser {
  id?: number; // PK, ìë™ ì¦ê°€
  admin_user_name: string; // ê´€ë¦¬ì ì•„ì´ë”” (UNIQUE)
  password: string; // ë¹„ë°€ë²ˆí˜¸ (í•´ì‹œ ê¶Œì¥)
  admin_name: string; // ê´€ë¦¬ì ì´ë¦„
  email: string; // ì´ë©”ì¼
  created_at?: string; // ìƒì„±ì¼ì‹œ
  updated_at?: string; // ìˆ˜ì •ì¼ì‹œ
}
```

#### 2. personal_user (ê°œì¸ ì‚¬ìš©ì)

```typescript
interface PersonalUser {
  id?: number; // PK, ìë™ ì¦ê°€
  personal_user_name: string; // ê°œì¸ ì•„ì´ë”” (UNIQUE)
  password: string; // ë¹„ë°€ë²ˆí˜¸ (í•´ì‹œ ê¶Œì¥)
  email: string; // ì´ë©”ì¼
  personal_name: string; // ì´ë¦„
  university?: string; // ëŒ€í•™êµëª…
  profile_image_url?: string; // í”„ë¡œí•„ ì´ë¯¸ì§€ URL
  birthdate?: string; // ìƒë…„ì›”ì¼ (YYYY-MM-DD)
  student_num?: string; // í•™ë²ˆ
  department?: string; // í•™ê³¼
  phone_num?: string; // ì „í™”ë²ˆí˜¸
  refresh_token?: string; // ë¦¬í”„ë ˆì‹œ í† í°
  univ_id?: number; // FK â†’ university.id
}
```

#### 3. club_user (ë™ì•„ë¦¬ ê³„ì •)

```typescript
interface ClubUser {
  id?: number; // PK, ìë™ ì¦ê°€
  club_user_name: string; // ë™ì•„ë¦¬ ì•„ì´ë”” (UNIQUE)
  password: string; // ë¹„ë°€ë²ˆí˜¸ (í•´ì‹œ ê¶Œì¥)
  club_name: string; // ë™ì•„ë¦¬ëª…
  club_email: string; // ë™ì•„ë¦¬ ì´ë©”ì¼
  manager_name: string; // ê´€ë¦¬ì ì´ë¦„
  manager_phone_num?: string; // ê´€ë¦¬ì ì „í™”ë²ˆí˜¸
  manager_student_num?: string; // ê´€ë¦¬ì í•™ë²ˆ
  manager_department?: string; // ê´€ë¦¬ì í•™ê³¼
  approved: boolean; // ìŠ¹ì¸ ì—¬ë¶€ (ê¸°ë³¸ê°’: false)
  bank?: string; // ì€í–‰ëª… (enum)
  account_number?: string; // ê³„ì¢Œë²ˆí˜¸
  refresh_token?: string; // ë¦¬í”„ë ˆì‹œ í† í°
  group_user_id?: number; // FK â†’ group_user.id
  category?: ClubCategory; // ì¹´í…Œê³ ë¦¬
  recruiting?: boolean; // ëª¨ì§‘ ì¤‘ ì—¬ë¶€
  score?: number; // í™œë™ ì ìˆ˜
  club_explanation?: string; // ìƒì„¸ ì„¤ëª…
  club_simple_explanation?: string; // ê°„ë‹¨ ì„¤ëª…
  instagram_url?: string; // ì¸ìŠ¤íƒ€ê·¸ë¨ URL
  youtube_url?: string; // ìœ íŠœë¸Œ URL
  banner_image_url?: string; // ë°°ë„ˆ ì´ë¯¸ì§€ URL
  profile_image_url?: string; // í”„ë¡œí•„ ì´ë¯¸ì§€ URL
}

type ClubCategory =
  | "í•™ìˆ "
  | "ê³µì—°"
  | "ì²´ìœ¡"
  | "ë´‰ì‚¬"
  | "ì¢…êµ"
  | "ë¬¸í™”"
  | "ê¸°íƒ€";
```

#### 4. group_user (ìº í¼ìŠ¤ ê³µì‹ ê³„ì •)

```typescript
interface GroupUser {
  id?: number; // PK, ìë™ ì¦ê°€
  group_user_name: string; // ê·¸ë£¹ ì•„ì´ë”” (UNIQUE)
  password: string; // ë¹„ë°€ë²ˆí˜¸ (í•´ì‹œ ê¶Œì¥)
  group_name: string; // ê·¸ë£¹ëª… (ì˜ˆ: "í™ìµëŒ€í•™êµ")
  group_email: string; // ê·¸ë£¹ ì´ë©”ì¼
  manager_name: string; // ê´€ë¦¬ì ì´ë¦„
  manager_phone_num?: string; // ê´€ë¦¬ì ì „í™”ë²ˆí˜¸
  manager_student_num?: string; // ê´€ë¦¬ì í•™ë²ˆ
  manager_department?: string; // ê´€ë¦¬ì í•™ê³¼
  approved: boolean; // ìŠ¹ì¸ ì—¬ë¶€ (ê¸°ë³¸ê°’: false)
  refresh_token?: string; // ë¦¬í”„ë ˆì‹œ í† í°
  univ_id?: number; // FK â†’ university.id
}
```

### ì°¸ì¡° í…Œì´ë¸”

#### 5. university (ëŒ€í•™êµ)

```typescript
interface University {
  id: number; // PK, ìë™ ì¦ê°€
  univ_name: string; // ëŒ€í•™êµëª… (UNIQUE)
}
```

### ê´€ê³„ í…Œì´ë¸”

#### 6. club_personal (ë™ì•„ë¦¬-ê°œì¸ ê´€ê³„)

```typescript
interface ClubPersonal {
  id: number; // PK, ìë™ ì¦ê°€
  personal_user_id: number; // FK â†’ personal_user.id
  club_user_id: number; // FK â†’ club_user.id
  role: string; // ì—­í•  (ì˜ˆ: "member", "admin", "manager")
  approved: boolean; // ìŠ¹ì¸ ì—¬ë¶€ (ê¸°ë³¸ê°’: false)
  created_at?: string; // ìƒì„±ì¼ì‹œ
  updated_at?: string; // ìˆ˜ì •ì¼ì‹œ
}
```

### ì½˜í…ì¸  í…Œì´ë¸”

#### 7. club_personal_article (ë™ì•„ë¦¬ ê²Œì‹œë¬¼)

```typescript
interface ClubPersonalArticle {
  id: number; // PK, ìë™ ì¦ê°€
  club_personal_id: number; // FK â†’ club_personal.id
  title: string; // ì œëª©
  content: string; // ë‚´ìš©
  image_urls?: string[]; // ì´ë¯¸ì§€ URL ë°°ì—´ (JSON)
  created_at?: string; // ìƒì„±ì¼ì‹œ
  updated_at?: string; // ìˆ˜ì •ì¼ì‹œ
}
```

#### 8. club_personal_like (ê²Œì‹œë¬¼ ì¢‹ì•„ìš”)

```typescript
interface ClubPersonalLike {
  id: number; // PK, ìë™ ì¦ê°€
  club_personal_article_id: number; // FK â†’ club_personal_article.id
  club_personal_id: number; // FK â†’ club_personal.id (ì¢‹ì•„ìš”í•œ ì‚¬ìš©ì)
  created_at?: string; // ìƒì„±ì¼ì‹œ
}
```

#### 9. club_personal_comment (ê²Œì‹œë¬¼ ëŒ“ê¸€)

```typescript
interface ClubPersonalComment {
  id: number; // PK, ìë™ ì¦ê°€
  club_personal_article_id: number; // FK â†’ club_personal_article.id
  club_personal_id: number; // FK â†’ club_personal.id (ëŒ“ê¸€ ì‘ì„±ì)
  content: string; // ëŒ“ê¸€ ë‚´ìš©
  created_at?: string; // ìƒì„±ì¼ì‹œ
  updated_at?: string; // ìˆ˜ì •ì¼ì‹œ
}
```

### ì¼ì • í…Œì´ë¸”

#### 10. club_personal_schedule (ë™ì•„ë¦¬ ì¼ì •)

```typescript
interface ClubPersonalSchedule {
  id: number; // PK, ìë™ ì¦ê°€
  club_user_id: number; // FK â†’ club_user.id
  title: string; // ì¼ì • ì œëª©
  content?: string; // ì¼ì • ë‚´ìš©
  date: string; // ë‚ ì§œ (YYYY-MM-DD)
  started_at?: string; // ì‹œì‘ ì‹œê°„ (HH:MM)
  ended_at?: string; // ì¢…ë£Œ ì‹œê°„ (HH:MM)
  location?: string; // ì¥ì†Œ
  created_at?: string; // ìƒì„±ì¼ì‹œ
  updated_at?: string; // ìˆ˜ì •ì¼ì‹œ
}
```

#### 11. schedule_participant (ì¼ì • ì°¸ê°€ì)

```typescript
interface ScheduleParticipant {
  id: number; // PK, ìë™ ì¦ê°€
  schedule_id: number; // FK â†’ club_personal_schedule.id
  club_personal_id: number; // FK â†’ club_personal.id
  created_at?: string; // ìƒì„±ì¼ì‹œ
}
```

#### 12. schedule_comment (ì¼ì • ëŒ“ê¸€)

```typescript
interface ScheduleComment {
  id: number; // PK, ìë™ ì¦ê°€
  schedule_id: number; // FK â†’ club_personal_schedule.id
  club_personal_id: number; // FK â†’ club_personal.id (ëŒ“ê¸€ ì‘ì„±ì)
  content: string; // ëŒ“ê¸€ ë‚´ìš©
  created_at?: string; // ìƒì„±ì¼ì‹œ
  updated_at?: string; // ìˆ˜ì •ì¼ì‹œ
}
```

### í”„ë¡œí•„ í…Œì´ë¸”

#### 13. club_user_profile (ë™ì•„ë¦¬ í”„ë¡œí•„ í™•ì¥)

```typescript
interface ClubUserProfile {
  id?: number; // PK, ìë™ ì¦ê°€
  club_user_id: number; // FK â†’ club_user.id (UNIQUE)
  score?: number; // í™œë™ ì ìˆ˜
  club_explanation?: string; // ìƒì„¸ ì„¤ëª…
  club_simple_explanation?: string; // ê°„ë‹¨ ì„¤ëª…
  instagram_url?: string; // ì¸ìŠ¤íƒ€ê·¸ë¨ URL
  youtube_url?: string; // ìœ íŠœë¸Œ URL
  banner_image_url?: string; // ë°°ë„ˆ ì´ë¯¸ì§€ URL
  profile_image_url?: string; // í”„ë¡œí•„ ì´ë¯¸ì§€ URL
  created_at?: string; // ìƒì„±ì¼ì‹œ
  updated_at?: string; // ìˆ˜ì •ì¼ì‹œ
}
```

## ğŸ”— ê´€ê³„ë„ (ERD)

```
university
  â”œâ”€â”€ personal_user (univ_id)
  â””â”€â”€ group_user (univ_id)

group_user
  â””â”€â”€ club_user (group_user_id)

club_user
  â”œâ”€â”€ club_personal (club_user_id)
  â”œâ”€â”€ club_personal_schedule (club_user_id)
  â””â”€â”€ club_user_profile (club_user_id)

personal_user
  â””â”€â”€ club_personal (personal_user_id)

club_personal
  â”œâ”€â”€ club_personal_article (club_personal_id)
  â”œâ”€â”€ club_personal_like (club_personal_id)
  â”œâ”€â”€ club_personal_comment (club_personal_id)
  â”œâ”€â”€ schedule_participant (club_personal_id)
  â””â”€â”€ schedule_comment (club_personal_id)

club_personal_article
  â”œâ”€â”€ club_personal_like (club_personal_article_id)
  â””â”€â”€ club_personal_comment (club_personal_article_id)

club_personal_schedule
  â”œâ”€â”€ schedule_participant (schedule_id)
  â””â”€â”€ schedule_comment (schedule_id)
```

## ğŸ“ ì¿¼ë¦¬ íŒ¨í„´

### ì‚¬ìš©ì ì¡°íšŒ

```typescript
// ê°œì¸ ì‚¬ìš©ì ì¡°íšŒ
const { data } = await supabase
  .from("personal_user")
  .select("*")
  .eq("personal_user_name", username)
  .single();

// ë™ì•„ë¦¬ ì‚¬ìš©ì ì¡°íšŒ (ìŠ¹ì¸ëœ ê²ƒë§Œ)
const { data } = await supabase
  .from("club_user")
  .select("*")
  .eq("club_user_name", username)
  .eq("approved", true)
  .single();
```

### ê´€ê³„ ì¡°íšŒ (JOIN)

```typescript
// ë™ì•„ë¦¬ ë©¤ë²„ ì¡°íšŒ
const { data } = await supabase
  .from("club_personal")
  .select(
    `
    *,
    personal_user:personal_user_id (
      id,
      personal_name,
      profile_image_url
    )
  `
  )
  .eq("club_user_id", clubId)
  .eq("approved", true);

// ì¼ì • ì°¸ê°€ì ì¡°íšŒ
const { data } = await supabase
  .from("schedule_participant")
  .select(
    `
    *,
    club_personal:club_personal_id (
      personal_user:personal_user_id (
        id,
        personal_name,
        profile_image_url
      )
    )
  `
  )
  .eq("schedule_id", scheduleId);
```

### ì§‘ê³„ ì¿¼ë¦¬

```typescript
// ë©¤ë²„ ìˆ˜ ê³„ì‚°
const { count } = await supabase
  .from("club_personal")
  .select("*", { count: "exact", head: true })
  .eq("club_user_id", clubId)
  .eq("approved", true);

// ê²Œì‹œë¬¼ ìˆ˜ ê³„ì‚°
const { count } = await supabase
  .from("club_personal_article")
  .select("*", { count: "exact", head: true })
  .in("club_personal_id", clubPersonalIds);
```

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ìŠ¹ì¸ ìƒíƒœ í™•ì¸**: `club_user`, `group_user`ëŠ” `approved` í•„ë“œ í™•ì¸ í•„ìˆ˜
2. **ì™¸ë˜í‚¤ ê´€ê³„**: JOIN ì‹œ ì˜¬ë°”ë¥¸ ê´€ê³„ ê²½ë¡œ ì‚¬ìš©
3. **íƒ€ì„ìŠ¤íƒ¬í”„**: `created_at`, `updated_at`ì€ ìë™ ê´€ë¦¬
4. **UNIQUE ì œì•½**: `*_user_name` í•„ë“œëŠ” ì¤‘ë³µ ë¶ˆê°€
5. **ì†Œí”„íŠ¸ ì‚­ì œ**: ì‚­ì œ ëŒ€ì‹  `approved: false` ë˜ëŠ” ìƒíƒœ í•„ë“œ ì‚¬ìš© ê¶Œì¥
6. **ì´ë¯¸ì§€ URL**: ìƒëŒ€ ê²½ë¡œ(`/image.png`) ë˜ëŠ” ì ˆëŒ€ URL ì €ì¥

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **ë¹„ë°€ë²ˆí˜¸**: í‰ë¬¸ ì €ì¥ ê¸ˆì§€, í•´ì‹œ ì²˜ë¦¬ í•„ìˆ˜
2. **RLS (Row Level Security)**: Supabase RLS ì •ì±… ì„¤ì • ê¶Œì¥
3. **ìŠ¹ì¸ ê²€ì¦**: í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìŠ¹ì¸ ìƒíƒœ í™•ì¸ í›„ ë°ì´í„° í‘œì‹œ
4. **ê¶Œí•œ ì²´í¬**: `role` í•„ë“œë¡œ ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬
